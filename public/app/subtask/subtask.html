<div class="container">
  <div class="row">
    <div class="tabbable-panel">
      <div class="tabbable-line">
        <ul class="nav nav-tabs ">
          <li ng-click="changeTab('UNASSIGNED');" ng-class="{'active': selectedTab == 'UNASSIGNED' }">
            <a data-toggle="tab">
              UNASSIGNED </a>
          </li>
          <li ng-click="changeTab('ASSIGNED');" ng-class="{'active': selectedTab == 'ASSIGNED' }">
            <a href="#tab_default_2" data-toggle="tab">
              ASSIGNED </a>
          </li>
        </ul>

        <div class="tab-content">
          <div class="tab-pane" id="tab_default_1" ng-class="{'active': selectedTab == 'UNASSIGNED' }">
            <h4>LIST OF SUBTASKS</h4>

            <div class="float-right">
              <button class="btn btn-success btn-add" type="button" ng-click="showModal()">
                <i class="glyphicon glyphicon-plus gs"></i>
                Add SubTask
              </button>
            </div>
            <table id="mytable" class="table table-hover table-bordered table-striped">
              <thead>
              <tr>
                <th>S.No</th>
                <th>CREATED DATE</th>
                <th>JIRA ID</th>
                <th>TYPE</th>
                <th>EFFORTS</th>
                <th>SCOPE</th>
                <th class="text-center">Actions</th>
                <th class="text-center">
                  <div class="assign-section" ng-show="user.userRole === 'LEAD'">
                    <input type="checkbox" value="" id="check" ng-model="isAllSelected" ng-change="checkAll()">
                    <select name="selectUser" ng-model="assignToId">
                      <option value="">--Select --</option>
                      <option ng-repeat="user in users" value="{{user.id}}">{{user.userName}}</option>
                    </select>
                    <button class='btn btn-info btn-xs' type="button" id="save" ng-click="assignToSprint()"><span
                        class="glyphicon glyphicon-ok"></span>Save
                    </button>
                  </div>

                  <div ng-hide="user.userRole === 'LEAD'">
                    <input type="checkbox" value="" id="check" ng-model="isAllSelected" ng-change="isSelectAll()">
                    <button class='btn btn-primary btn-sm' type="button" ng-click="assignToSprint()">Assign To Me</button>
                  </div>

                </th>
              </tr>
              </thead>

              <tbody>
              <tr ng-repeat="subtask in unassignedTasks track by $index">
                <td>{{$index+1}}
                <td>{{subtask.userStoryStatus.createdDate}}</td>
                <td>{{subtask.jiraId}}</td>
                <td>{{subtask.type}}</td>
                <td>{{subtask.estEfforts}}</td>
                <td>{{subtask.scope}}</td>
                <td class="text-center table-actions-medium">
                  <button class='btn btn-info btn-xs' type="button" ng-click="">
                    <span class="glyphicon glyphicon-edit"></span> Edit
                  </button>
                  <button class="btn btn-danger btn-xs" ng-click="">
                    <span class="glyphicon glyphicon-trash"></span> Del
                  </button>
                </td>
                <td class="assign-selection-checkbox">
                  <input type="checkbox" ng-model="subtaskSelection[$index]"
                         ng-change="onItemSelected(subtask, subtaskSelection[$index], $index)">
                </td>
              </tr>
              </tbody>
            </table>
          </div>

          <div class="tab-pane" id="tab_default_2" ng-class="{'active': selectedTab == 'ASSIGNED' }">
            <table id="mytable" class="table table-hover table-bordered table-striped" width="100%">
              <thead>
              <tr>
                <th class="text-center" width="2%">S.No</th>
                <th class="text-center" width="13%">CREATED DATE</th>
                <th class="text-center" width="13%">ASSIGNED DATE</th>
                <th class="text-center" width="12%">JIRA ID</th>
                <th class="text-center" width="9%">TYPE</th>
                <th class="text-center" width="8%">EFFORTS</th>
                <th class="text-center" width="9%">SCOPE</th>
                <th class="text-center" width="20%">STATUS</th>
                <th class="text-center" width="12%">Action</th>
              </tr>
              </thead>

              <tbody>
              <tr ng-repeat="subtask in subtasks track by $index">
                <td align="center">{{$index+1}}
                <td align="center">{{subtask.userStoryStatus.createdDate}}</td>
                <td align="center">{{subtask.userStoryStatus.assignedDate}}</td>
                <td align="center">{{subtask.jiraId}}</td>
                <td align="center">{{subtask.type}}</td>
                <td align="center">{{subtask.estEfforts}}</td>
                <td align="center">{{subtask.scope}}</td>
                <td align="center">
                  <div ng-show="!editStorySelection[$index]">
                    {{subtask.userStoryStatus.status}}
                  </div>
                  <div ng-show="editStorySelection[$index]">
                    <select ng-model="subtask.userStoryStatus.status">
                      <option value="">--Select --</option>
                      <option ng-repeat="option in availableOptions"
                              ng-selected="{{subtask.userStoryStatus.status == option.value}}" value="{{option.value}}">
                        {{option.name}}
                      </option>
                    </select>
                  </div>
                </td>
                <td align="center">
                  <div ng-show="!editStorySelection[$index]">
                    <div data-placement="top" data-toggle="tooltip" title="Edit">
                      <button class='btn btn-info btn-xs' type="button" data-title="Edit" ng-click="editStorySelection[$index] = true"><span
                          class="glyphicon glyphicon-edit"></span>Edit
                      </button>
                    </div>
                  </div>
                  <div ng-show="editStorySelection[$index]">
                    <div data-placement="top" data-toggle="tooltip">
                      <button class='btn btn-success btn-xs' type="button" ng-click="saveSubtaskStatus(subtask, $index)"><span
                          class="glyphicon glyphicon-ok"></span>Save
                      </button>
                      <button class='btn btn-default btn-xs' type="button" ng-click="editStorySelection[$index] = false"><span
                          class="glyphicon glyphicon-remove"></span>Cancel
                      </button>
                    </div>
                  </div>
                </td>
              </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<tms-modal modal-visible="isModalVisible" backdrop="static" on-sown="" on-hide="">
  <modal-header title="Add Subtask"></modal-header>
  <modal-body>
    <div class="sprint-errors" ng-show="errorMessage">
      <div class="alert alert-warning">
        <strong>Error. </strong> {{errorMessage}}
      </div>
    </div>

    <div class="form-group">
      <label class="label-title">Story:</label>
      <select id="moduleDropdown" name="module" text="Select Story" class="form-control" ng-model=subtask.storyId>
        <option value="{{story.storyId}}" data-ng-repeat="story in stories">{{story.jiraId}}</option>
      </select>
    </div>

    <div class="form-group">
      <label class="label-title">Jira Id:</label>
      <input class="form-control" id="disabledInput" placeholder="Jira Id (e.g DOMO-0123)" type="text"  ng-model="subtask.jiraId">
    </div>

    <div class="form-group">
      <!--<label class="label-title">Created Date:</label>-->
      <tms-datepicker label="Created Date:" ng-model="subtask.createdDate"></tms-datepicker>
    </div>

    <div class="form-group">
      <label class="label-title">Efforts:</label>
      <input class="form-control" type="text" placeholder="Efforts" ng-model="subtask.efforts" ng-required ="true">
    </div>

    <div class="form-group">
      <label class="label-title">Scope:</label>
      <select id="moduleDropdown" name="module" placeholder="Select Module" class="form-control" ng-model=subtask.scope>
        <option value="PLANED" >Planed</option>
        <option value="UNPLANED" >Unplaned</option>
      </select>
    </div>

    <div class="form-group">
      <label class="label-title">Scope:</label>
      <select id="moduleDropdown" name="module" placeholder="Select Module" class="form-control" ng-model=subtask.type>
        <option value="BUG" >Bug</option>
        <option value="SUBTASK">Subtask</option>
      </select>
    </div>
  </modal-body>
  <modal-footer>
    <button type="button" class="btn btn-secondary" ng-click="closeModal()">Cancel</button>
    <button type="button" class="btn btn-primary" ng-disabled="error" ng-click="addSubtask(subtask)">Add</button>
  </modal-footer>
</tms-modal>

<!-- <ng-include src="'subtask/add-subtask.html'"></ng-include>
 -->


